<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mini Mock ชุดที่ 1 — Quiz</title>
<style>
  :root{font-family: "Segoe UI", Roboto, "Noto Sans", sans-serif}
  body{max-width:900px;margin:28px auto;padding:20px;background:#f7fafc;color:#102a43}
  h1{font-size:1.6rem;margin-bottom:4px}
  p.lead{color:#334e68;margin-top:0}
  .card{background:#fff;border-radius:10px;padding:16px;margin:12px 0;box-shadow:0 6px 18px rgba(16,42,67,0.06)}
  .question{margin-bottom:10px}
  .q-title{font-weight:600}
  .choices{margin-top:8px}
  label.choice{display:block;padding:8px;border-radius:6px;border:1px solid transparent;margin:6px 0;cursor:pointer}
  input[type=radio]{margin-right:8px}
  table{border-collapse:collapse;width:100%;margin-top:8px}
  td,th{border:1px solid #ccc;padding:6px;text-align:center}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:14px}
  button{padding:10px 14px;border-radius:8px;border:0;cursor:pointer}
  button.primary{background:#0b6efd;color:#fff}
  button.ghost{background:#edf2ff;border:1px solid #dbe7ff}
  .result{padding:10px;margin-top:12px;border-radius:8px}
  .correct{background:#e6ffed;border:1px solid #bdebb0}
  .incorrect{background:#fff2f2;border:1px solid #ffcccc}
  .unanswered{background:#fffbe6;border:1px solid #ffe58f}
  /* toggle เฉลยละเอียด */
  details.explain{margin-top:10px;border-top:1px dashed #d0d7de;padding-top:8px;display:none}
  details.explain.show{display:block}
  details.explain summary{cursor:pointer;font-weight:600}
  .explain-body{margin-top:6px;color:#334e68}
  .alert{background:#fffbe6;border:1px solid #ffe58f;color:#614700;border-radius:8px;padding:10px;margin:12px 0}
  .alert a{color:inherit;text-decoration:underline}
</style>
</head>
<body>
<h1>Mini Mock ชุดที่ 1 — Quiz By Yoursphere</h1>
<p class="lead">ตอบคำถามจากข้อสอบ 15 ข้อ YOURSPHERE เป็นเจ้าของแบบทดสอบทั้งหมดรวมถึงทรัพย์สินทางปัญญาของการทดสอบและเอกสารนี้ภายใต้กฎหมายคุ้มครองลิขสิทธิ์ฯ</p>
<p class="lead">การทำซ้ำ หรือ ดัดแปลง หรือ เผยแพร่ หรือ อ้างถึง เนื้อหา และ/หรือ สารสนเทศใดๆ ทั้งหมด หรือ ส่วนหนึ่งส่วนใด ในเอกสารนี้ โดยมิได้รับอนุญาต จะถูกดำเนินคดีตามกฎหมาย</p>

<form id="quizForm">

  <!-- ข้อมูลผู้ทำแบบทดสอบ -->
  <div class="card">
    <div class="q-title">ข้อมูลผู้ทำแบบทดสอบ</div>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <input id="uName"  type="text"  placeholder="ชื่อ"  style="padding:8px;border:1px solid #cbd5e1;border-radius:6px">
      <input id="uEmail" type="email" placeholder="อีเมล" style="padding:8px;border:1px solid #cbd5e1;border-radius:6px">
    </div>
    <label style="display:block;margin-top:8px">
      <input type="checkbox" id="consent"> ฉันยินยอมให้บันทึกข้อมูลผลการทำแบบทดสอบนี้ลงระบบหลังบ้าน (Google Sheet)
    </label>
  </div>

  <!-- ข้อ 1 -->
  <div class="card question" data-q="1">
    <div class="q-title">1. จากสายใยอาหารข้างต้น ข้อใดไม่ถูกต้อง</div>
    <div class="choices">
      <label class="choice"><input type="radio" name="q1" value="1">1) หากจำนวนงูลดลง เหยี่ยวจะมีจำนวนลดลงตาม แต่หนูจะมีจำนวนมากขึ้น</label>
      <label class="choice"><input type="radio" name="q1" value="2">2) ปริมาณสารพิษจะสะสมที่สิงโตมากที่สุด</label>
      <label class="choice"><input type="radio" name="q1" value="3">3) ผู้บริโภคที่มีลำดับสูงที่สุด คือสิงโต ผู้บริโภคลำดับที่ 5</label>
      <label class="choice"><input type="radio" name="q1" value="4">4) กฎ 10 เปอร์เซ็นต์ (Ten percent law) ไม่สามารถใช้ได้เพราะสายใยอาหารมีความซับซ้อนกว่าห่วงโซ่อาหาร</label>
      <label class="choice"><input type="radio" name="q1" value="5">5) มีข้อที่ผิดมากกว่าหนึ่งข้อ</label>
    </div>
  </div>

  <!-- ข้อ 2 -->
  <div class="card question" data-q="2">
    <div class="q-title">2. พิจารณาข้อความต่อไปนี้ ข้อใดถูกต้อง</div>
    <div class="choices">
      <label class="choice"><input type="radio" name="q2" value="1">1) หากต้องการเลือกน้ำจากแหล่งน้ำมาใช้ ควรเลือกน้ำจากแหล่งน้ำ d เนื่องจากมีค่า BOD มากที่สุด บ่ง บอกถึงปริมาณจุลินทรีย์ที่มีชีวิตในแหล่งน้ำนั้น ๆ</label>
      <label class="choice"><input type="radio" name="q2" value="2">2) หากต้องการเลือกน้ำจากแหล่งน้ำมาใช้ สามารถเลือกน้ำจากแหล่งน้ำ b c d หรือ e ก็ได้ เนื่องจาก มีค่า BOD ที่ค่อนข้างสูง บ่งบอกถึงปริมาณออกซิเจนที่ละลายอยู่ในน้ำ</label>
      <label class="choice"><input type="radio" name="q2" value="3">3) หากต้องการเลือกน้ำจากแหล่งน้ำมาใช้ ควรเลือกน้ำจากแหล่งน้ำ a เนื่องจากมีค่า BOD ต่ำที่สุด บ่งบอกถึงปริมาณออกซิเจนที่จุลินทรีย์ต้องใช้เพื่อย่อยสลายสารอินทรีย์</label>
      <label class="choice"><input type="radio" name="q2" value="4">4) หากต้องการเลือกน้ำจากแหล่งน้ำมาใช้ ควรเลือกน้ำจากแหล่งน้ำ a เนื่องจากมีค่า BOD ต่ำที่สุด บ่งบอกถึงปริมาณจุลินทรีย์มีชีวิตที่ต่ำ ซึ่งใช้ออกซิเจนในการหายใจต่ำลงด้วย</label>
      <label class="choice"><input type="radio" name="q2" value="5">5) สามารถใช้น้ำจากแหล่งน้ำใดก็ได้ ค่า BOD ไม่ได้บ่งบอกถึงคุณภาพน้ำโดยตรง ต้องอาศัยค่า OD ในการพิจารณาร่วมด้วย</label>
    </div>
  </div>

  <!-- ข้อ 3 ตาราง -->
  <div class="card question" data-q="3">
    <div class="q-title">3. ข้อใดระบุสิ่งมีชีวิตได้ถูกต้องทั้งหมด</div>
    <table>
      <tr><th>B</th><th>D</th><th>E</th><th>F</th><th>G</th></tr>
      <tr><td>ปลิงน้ำจืด</td><td>ปลาฉลาม</td><td>ไส้เดือน</td><td>ผึ้ง</td><td>หอยมือเสือ</td></tr>
      <tr><td>พยาธิแส้ม้า</td><td>เพรียงหัวหอม</td><td>ทากดูดเลือด</td><td>หมึก</td><td>พลานาเรีย</td></tr>
      <tr><td>พยาธิไส้เดือน</td><td>เม่นทะเล</td><td>ผีเสื้อ</td><td>ไส้เดือน</td><td>หอยปากเป็ด</td></tr>
      <tr><td>ไส้เดือน</td><td>ดาวทะเล</td><td>จิงโจ้น้ำ</td><td>แมลงสาบ</td><td>พยาธิใบไม้</td></tr>
      <tr><td>ไส้เดือนฝอย</td><td>ปลิงทะเล</td><td>แมงมุม</td><td>แม่เพรียง</td><td>หมึก</td></tr>
    </table>
    <div class="choices">
      <label class="choice"><input type="radio" name="q3" value="1">1</label>
      <label class="choice"><input type="radio" name="q3" value="2">2</label>
      <label class="choice"><input type="radio" name="q3" value="3">3</label>
      <label class="choice"><input type="radio" name="q3" value="4">4</label>
      <label class="choice"><input type="radio" name="q3" value="5">5</label>
    </div>
  </div>

  <!-- ข้อ 4 -->
  <div class="card question" data-q="4">
    <div class="q-title">4. ข้อใดถูกต้อง</div>
    <div class="choices">
      <label class="choice"><input type="radio" name="q4" value="1">1) ก. และ ค. เท่านั้น</label>
      <label class="choice"><input type="radio" name="q4" value="2">2) ก. และ ง. เท่านั้น</label>
      <label class="choice"><input type="radio" name="q4" value="3">3) ข. และ ค. เท่านั้น</label>
      <label class="choice"><input type="radio" name="q4" value="4">4) ข. และ ง. เท่านั้น</label>
      <label class="choice"><input type="radio" name="q4" value="5">5) ค. และ ง. เท่านั้น</label>
    </div>
  </div>

  <!-- ข้อ 5 -->
  <div class="card question" data-q="5">
    <div class="q-title">5. ข้อใดไม่ถูกต้อง</div>
    <div class="choices">
      <label class="choice"><input type="radio" name="q5" value="1">1) ก. และ ข. เท่านั้น</label>
      <label class="choice"><input type="radio" name="q5" value="2">2) ก. และ ค. เท่านั้น</label>
      <label class="choice"><input type="radio" name="q5" value="3">3) ก. และ ง. เท่านั้น</label>
      <label class="choice"><input type="radio" name="q5" value="4">4) ข. และ ค. เท่านั้น</label>
      <label class="choice"><input type="radio" name="q5" value="5">5) ข. และ ง. เท่านั้น</label>
    </div>
  </div>

  <!-- ข้อ 6 -->
  <div class="card question" data-q="6">
    <div class="q-title">6. ข้อใดถูกต้อง</div>
    <div class="choices">
      <label class="choice"><input type="radio" name="q6" value="1">1) ก. และ ข. เท่านั้น</label>
      <label class="choice"><input type="radio" name="q6" value="2">2) ก. และ ค. เท่านั้น</label>
      <label class="choice"><input type="radio" name="q6" value="3">3) ก. และ ง. เท่านั้น</label>
      <label class="choice"><input type="radio" name="q6" value="4">4) มีข้อที่กล่าวถูกต้องเพียงข้อเดียว</label>
      <label class="choice"><input type="radio" name="q6" value="5">5) ไม่มีข้อความใดกล่าวถูกต้อง</label>
    </div>
  </div>

  <!-- ข้อ 7 -->
  <div class="card question" data-q="7">
    <div class="q-title">7. ท่านจะแสดงความคิดเห็นในข้อใดที่กล่าวถูกต้องที่สุด</div>
    <div class="choices">
      <label class="choice"><input type="radio" name="q7" value="1">1) คนไข้รายนี้น่าจะเป็นโรคเบาหวานชนิดที่ 2 เนื่องจากปริมาณน้ำตาลที่สูงกว่าค่าปกติ</label>
      <label class="choice"><input type="radio" name="q7" value="2">2) คนไข้รายนี้อาจพบโปรตีนที่รีนัลเวนน้อยกว่าปกติ เนื่องจากความผิดปกติที่โกลเมอรูลัส</label>
      <label class="choice"><input type="radio" name="q7" value="3">3) คนไข้รายนี้น่าจะมีความผิดปกติที่ท่อหน่วยไตส่วนต้น เนื่องจากยังพบโปรตีนสูงกว่าค่าปกติในของเหลวที่ผ่านการกรอง</label>
      <label class="choice"><input type="radio" name="q7" value="4">4) หากการทำงานของไตปกติ อาจเป็นผลมาจากการหลั่งฮอร์โมนจากต่อมใต้สมองส่วนหลังที่มากเกินไป จนทำให้ความเข้มข้นของโซเดียมไอออนสูงขึ้น</label>
      <label class="choice"><input type="radio" name="q7" value="5">5) เหตุการณ์นี้ทำให้มีแรงดันออสโมติกที่สูงที่บริเวณรีนัลอาร์เทอร์รี จึงทำให้เกิดการกระตุ้นให้หลั่ง ADH เพื่อดูดน้ำและโซเดียมกลับ</label>
    </div>
  </div>

  <!-- ข้อ 8 -->
  <div class="card question" data-q="8">
    <div class="q-title">8. ข้อใดจับคู่ต่อมและฮอร์โมนได้ถูกต้อง</div>
    <table>
      <tr><th>ต่อม A</th><th>ต่อม B</th><th>ฮอร์โมน C</th><th>ฮอร์โมน D</th></tr>
      <tr><td>Thyroid</td><td>Parathyroid</td><td>Thyroxine</td><td>PTH</td></tr>
      <tr><td>Thyroid</td><td>Parathyroid</td><td>Calcitonin</td><td>PTH</td></tr>
      <tr><td>Thyroid</td><td>Parathyroid</td><td>PTH</td><td>Calcitonin</td></tr>
      <tr><td>Parathyroid</td><td>Thyroid</td><td>Calcitonin</td><td>PTH</td></tr>
      <tr><td>Parathyroid</td><td>Thyroid</td><td>PTH</td><td>Calcitonin</td></tr>
    </table>
    <div class="choices">
      <label class="choice"><input type="radio" name="q8" value="1">1</label>
      <label class="choice"><input type="radio" name="q8" value="2">2</label>
      <label class="choice"><input type="radio" name="q8" value="3">3</label>
      <label class="choice"><input type="radio" name="q8" value="4">4</label>
      <label class="choice"><input type="radio" name="q8" value="5">5</label>
    </div>
  </div>

  <!-- ข้อ 9 -->
  <div class="card question" data-q="9">
    <div class="q-title">9. การเพิ่มขึ้นของระดับฮอร์โมน A หลังการตกไข่ทำให้เกิดกระบวนการใดในร่างกาย</div>
    <div class="choices">
      <label class="choice"><input type="radio" name="q9" value="1">1) ผนังมดลูกหนาตัวขึ้นเพื่อเตรียมให้ไข่ที่ปฏิสนธิแล้วมาฝังตัว</label>
      <label class="choice"><input type="radio" name="q9" value="2">2) การตกไข่จะถูกกระตุ้นให้เกิดขึ้นซ้ำในรอบเดือนเดียวกันหากไม่มีการปฏิสนธิ</label>
      <label class="choice"><input type="radio" name="q9" value="3">3) ลดการดูดกลับน้ำ และ Na⁺ ที่ไต</label>
      <label class="choice"><input type="radio" name="q9" value="4">4) ฮอร์โมน A จะยับยั้งการเพิ่มขึ้นของฮอร์โมน B</label>
      <label class="choice"><input type="radio" name="q9" value="5">5) เพิ่มการหลั่ง LH ในร่างกาย</label>
    </div>
  </div>

  <!-- ข้อ 10 -->
  <div class="card question" data-q="10">
    <div class="q-title">10. ข้อใด “ไม่ถูกต้อง” เกี่ยวกับพฤติกรรมของสิ่งมีชีวิต</div>
    <div class="choices">
      <label class="choice"><input type="radio" name="q10" value="1">1) พฤติกรรมการไอ/จามเมื่อมีสิ่งแปลกปลอมเข้าไปในทางเดินหายใจ จัดเป็นพฤติกรรมที่อยู่ในกลุ่ม พฤติกรรมที่มีมาตั้งแต่กำเนิด (innate behavior)</label>
      <label class="choice"><input type="radio" name="q10" value="2">2) พฤติกรรมการว่ายทวนน้ำของปลาแซลมอนเพื่อกลับไปวางไข่ในแม่น้ำที่เกิดโดยอาศัยกลิ่นของแม่น้ำเป็นสิ่งเร้า จัดเป็นพฤติกรรมที่อยู่ในกลุ่ม พฤติกรรมการเรียนรู้ (learned behavior)</label>
      <label class="choice"><input type="radio" name="q10" value="3">3) การเดินตามวัตถุที่ส่งเสียงและเคลื่อนที่ได้ของลูกไก่ เป็นพฤติกรรมการฝังใจ(imprinting)</label>
      <label class="choice"><input type="radio" name="q10" value="4">4) การลดของอัตราการบินหนีหุ่นไล่กาของนกเกิดจากพฤติกรรมความเคยชิน (habituation)</label>
      <label class="choice"><input type="radio" name="q10" value="5">5) ลิงซิมแปนซีใช้ไม้เขี่ยแอปเปิลที่วางอยู่นอกกรงและหยิบไม่ถึงเป็นพฤติกรรมการลองผิดลองถูก(trial and error)</label>
    </div>
  </div>

  <!-- ข้อ 11 -->
  <div class="card question" data-q="11">
    <div class="q-title">11. ข้อใดกล่าวถูกต้อง</div>
    <div class="choices">
      <label class="choice"><input type="radio" name="q11" value="1">1) ก. และ ข. เท่านั้น</label>
      <label class="choice"><input type="radio" name="q11" value="2">2) ก. และ ค. เท่านั้น</label>
      <label class="choice"><input type="radio" name="q11" value="3">3) ข. และ ค. เท่านั้น</label>
      <label class="choice"><input type="radio" name="q11" value="4">4) ก. ข. และ ค.</label>
      <label class="choice"><input type="radio" name="q11" value="5">5) ไม่มีข้อใดกล่าวถูกต้อง</label>
    </div>
  </div>

  <!-- ข้อ 12 -->
  <div class="card question" data-q="12">
    <div class="q-title">12. ข้อใดถูกต้อง</div>
    <div class="choices">
      <label class="choice"><input type="radio" name="q12" value="1">1) ก. และ ข. เท่านั้น</label>
      <label class="choice"><input type="radio" name="q12" value="2">2) ก. และ ค. เท่านั้น</label>
      <label class="choice"><input type="radio" name="q12" value="3">3) ข. และ ค. เท่านั้น</label>
      <label class="choice"><input type="radio" name="q12" value="4">4) ก. ข. และ ค.</label>
      <label class="choice"><input type="radio" name="q12" value="5">5) ไม่มีข้อใดกล่าวถูกต้อง</label>
    </div>
  </div>

  <!-- ข้อ 13 -->
  <div class="card question" data-q="13">
    <div class="q-title">13. ข้อใดถูกต้อง</div>
    <div class="choices">
      <label class="choice"><input type="radio" name="q13" value="1">1) ก. ข. และ ค.</label>
      <label class="choice"><input type="radio" name="q13" value="2">2) ก. ค. และ ง.</label>
      <label class="choice"><input type="radio" name="q13" value="3">3) ก. ค. และ จ.</label>
      <label class="choice"><input type="radio" name="q13" value="4">4) ก. ข. และ ง.</label>
      <label class="choice"><input type="radio" name="q13" value="5">5) ข. ค. และ จ.</label>
    </div>
  </div>

  <!-- ข้อ 14 -->
  <div class="card question" data-q="14">
    <div class="q-title">14. พงศาวลีของครอบครัว — ใช่/ไม่ใช่</div>
    <div class="choices">
      <div>14.1 ความผิดปกตินี้น่าจะถ่ายทอดแบบเด่น</div>
      <label class="choice"><input type="radio" name="q14_1" value="yes">ใช่</label>
      <label class="choice"><input type="radio" name="q14_1" value="no">ไม่ใช่</label>
      <div>14.2 รูปแบบการถ่ายทอดมียีนอยู่บนโครโมโซม X</div>
      <label class="choice"><input type="radio" name="q14_2" value="yes">ใช่</label>
      <label class="choice"><input type="radio" name="q14_2" value="no">ไม่ใช่</label>
      <div>14.3 หาก II-4 แต่งงานกับชายที่มีความผิดปกติ ลูกทั้งหมดจะปกติ</div>
      <label class="choice"><input type="radio" name="q14_3" value="yes">ใช่</label>
      <label class="choice"><input type="radio" name="q14_3" value="no">ไม่ใช่</label>
    </div>
  </div>

  <!-- ข้อ 15 -->
  <div class="card question" data-q="15">
    <div class="q-title">15. กรณีลีเมอร์ — ใช่/ไม่ใช่</div>
    <div class="choices">
      <div>15.1 ความถี่แอลลีน A=0.6, a=0.4 จะไม่เปลี่ยนภายใต้ H-W</div>
      <label class="choice"><input type="radio" name="q15_1" value="yes">ใช่</label>
      <label class="choice"><input type="radio" name="q15_1" value="no">ไม่ใช่</label>
      <div>15.2 หากกลับมาอยู่ด้วยกันจะสืบพันธุ์ได้</div>
      <label class="choice"><input type="radio" name="q15_2" value="yes">ใช่</label>
      <label class="choice"><input type="radio" name="q15_2" value="no">ไม่ใช่</label>
      <div>15.3 การขาดแคลนอาหารทำให้ตายมาก เป็นการคัดเลือกโดยธรรมชาติ</div>
      <label class="choice"><input type="radio" name="q15_3" value="yes">ใช่</label>
      <label class="choice"><input type="radio" name="q15_3" value="no">ไม่ใช่</label>
    </div>
  </div>

  <div class="controls">
    <button type="button" class="primary" id="submitBtn">ส่งคำตอบ</button>
    <button type="button" class="ghost" id="resetBtn">ล้างคำตอบ</button>
  </div>

  <div id="resultArea"></div>
</form>

<script>
// ===== เฉลยตามที่กำหนด =====
const answers = {
  q1:'5', q2:'3', q3:'5', q4:'5', q5:'3', q6:'4', q7:'2', q8:'5',
  q9:'1', q10:'5', q11:'2', q12:'2', q13:'3',
  q14_1:'no', q14_2:'no', q14_3:'yes',
  q15_1:'yes', q15_2:'no', q15_3:'no'
};

// ===== เฉลยละเอียด (แก้/เติมข้อความได้) =====
const explanations = {
  q1: [
    'เฉลย 5 ผิดข้อ 3 และ 4',
    '• ข้อ 3: สิงโต trophic level 5 แต่เป็นผู้บริโภคลำดับที่ 4',
    '• ข้อ 4: กฎ 10% ยังใช้ได้ เพียงแต่อธิบายเป็นสายใยไม่ได้ง่ายเหมือนห่วงโซ่'
  ].join('\n'),
  q2: [
    'เฉลย 3: นิยาม BOD = O₂ ที่จุลินทรีย์ใช้ย่อยสารอินทรีย์',
    'BOD สูง → น้ำเน่าเสียมาก, BOD ต่ำ → คุณภาพดีกว่า'
  ].join('\n'),
  q3: [
    'A→Platyhelminthes, B→Nematoda, C→Chordata, D→Echinodermata, E→Arthropoda, F→Annelida, G→Mollusca',
    'ข้อควรระวัง: ทาก/หอยทาก/ปลิงทะเล=Mollusca; ปลิงน้ำจืด/แม่เพรียง=Annelida'
  ].join('\n'),
  q4: [
    'เฉลย 5 (ค,ง ถูก):',
    '• ค: ขั้วมากกว่าละลายน้ำดีกว่า',
    '• ง: competitive inhibitor แย่ง substrate → เพิ่ม [substrate] ช่วยได้'
  ].join('\n'),
  q5: [
    'เฉลย 3 (ก,ง ผิด):',
    '• ก: ไตรกลีเซอไรด์ 1 โมเลกุล → น้ำ 3 โมเลกุล',
    '• ง: DNA/RNA ต่างกันที่น้ำตาลและชนิดเบส จุดเกาะฟอสเฟต (C5’) เหมือนกัน'
  ].join('\n'),
  q6: [
    'เฉลย 4: A isotonic (คงรูป), B hypertonic (เหี่ยว); isotonic NaCl ≈ 0.9%',
    'หยดน้ำจืดลง A → เต่ง (พืชไม่แตก)'
  ].join('\n'),
  q7: [
    'เฉลย 2: โปรตีนโผล่ใน filtrate + Na⁺ สูง → ชี้ปัญหา glomerulus/การดูดกลับ'
  ].join('\n'),
  q8: [
    'เฉลย 5: Thyroid→Calcitonin (ลด Ca²⁺), Parathyroid→PTH (เพิ่ม Ca²⁺)'
  ].join('\n'),
  q9: [
    'เฉลย 1: Progesterone หลังตกไข่ทำให้มดลูกหนาตัวรอฝังตัว'
  ].join('\n'),
  q10: [
    'เฉลย “ข้อที่ไม่ถูกต้อง” = 5: ที่เห็นเป็น reasoning มากกว่า trial & error'
  ].join('\n'),
  q11: [
    'เฉลย 2: ก และ ค ถูก (ก=phloem, ค=fiber รอบนอก ผนังหนา มี lignin)'
  ].join('\n'),
  q12: [
    'เฉลย 2: (ก) active loading sucrose → น้ำ osmosis เข้า; (ค) น้ำออกจาก sieve tube ด้วย osmosis'
  ].join('\n'),
  q13: [
    'เฉลย 3: ก(เป็น PCR), ค(พบ U → ไม่ใช่ DNA), จ(เริ่ม AUG → ได้ 6 ตัว)'
  ].join('\n'),
  q14: [
    'สรุป: autosomal (เงื่อนไข X/Y-linked ขัดกับ pedigree)',
    '14.3 แต่งงานกับผู้ชายเป็นโรค ลูก “สามารถ” ปกติได้'
  ].join('\n'),
  q15: [
    '15.1 ใช่ (H-W คงที่), 15.2 ไม่ใช่ (reproductive barrier), 15.3 ไม่ใช่ (คล้าย bottleneck effect)'
  ].join('\n')
};

// ===== Helpers =====
function getFormValue(name){
  let els = document.getElementsByName(name);
  if (!els.length && !/^q/.test(name)) els = document.getElementsByName('q'+name);
  for (let i=0;i<els.length;i++) if (els[i].checked) return els[i].value;
  return null;
}
function prettyKey(key){ return key.replace(/^q/,'').replace('_','.'); }
function scrollToQuestion(key){
  const qNum = key.replace(/^q/,'').split('_')[0];
  const el = document.querySelector(`.question[data-q="${qNum}"]`);
  if (el) el.scrollIntoView({behavior:'smooth', block:'center'});
}
function ensureExplainToggle(qNum){
  const card = document.querySelector(`.question[data-q="${qNum}"]`);
  if (!card) return;
  if (card.querySelector('details.explain')) return;
  const d = document.createElement('details');
  d.className = 'explain';
  const s = document.createElement('summary');
  s.textContent = 'เฉลยละเอียด (คลิกเพื่อเปิด)';
  const b = document.createElement('div');
  b.className = 'explain-body';
  const text = explanations['q'+qNum] || `เฉลยละเอียดข้อ ${qNum} — (พิมพ์รายละเอียด)`;
  b.innerHTML = text.replace(/\n/g,'<br>');
  d.appendChild(s); d.appendChild(b);
  card.appendChild(d);
}
function showAllExplanations(){
  document.querySelectorAll('details.explain').forEach(d=>d.classList.add('show'));
}
function collectAllAnswers() {
  const keys = Object.keys(answers);
  const out = {};
  for (const k of keys) out[k] = getFormValue(k);
  return out;
}

// ===== ส่งข้อมูลไป Google Apps Script (แทนที่ URL ให้เป็น /exec ของคุณ) =====
async function sendResultToSheet(data) {
  const GAS_URL = 'https://script.google.com/macros/s/PUT_YOUR_EXEC_URL_HERE/exec'; // <— แก้เป็นของคุณ
  // ใช้ text/plain + no-cors เพื่อให้เป็น simple request (เลี่ยง preflight/CORS)
  await fetch(GAS_URL, {
    method: 'POST',
    mode: 'no-cors',
    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
    body: JSON.stringify(data)
  });
}

// ===== Main =====
const submitBtn = document.getElementById('submitBtn');
const resetBtn  = document.getElementById('resetBtn');
const resultArea = document.getElementById('resultArea');

submitBtn.addEventListener('click', async ()=>{
  // 1) เช็คตอบครบ
  const keys = Object.keys(answers);
  const unanswered = keys.filter(k => getFormValue(k) == null);
  if (unanswered.length){
    const niceList = unanswered.map(prettyKey);
    resultArea.innerHTML = `
      <div class="alert">
        คุณยังตอบไม่ครบ ✋ กรุณาตอบให้ครบก่อนส่ง<br>
        เว้นไว้: ${niceList.join(', ')}
      </div>`;
    scrollToQuestion(unanswered[0]);
    return;
  }

  // 2) ตรวจคำตอบ + แสดงผล
  let correct=0,total=keys.length, output='';
  for(const key of keys){
    const val = getFormValue(key);
    const isCorrect = val === answers[key];
    if (isCorrect) correct++;
    const niceKey = prettyKey(key);
    const cls = isCorrect ? 'correct' : 'incorrect';
    output += `<div class='${cls}'>
      ${niceKey}: คุณตอบ ${val} — คำตอบที่ถูกคือ ${answers[key]}
    </div>`;
  }
  const percent = Math.round(correct/total*100);

  resultArea.innerHTML =
    `<div class='card'>ถูก ${correct} จาก ${total} (${percent}%) 
      <div style="margin-top:6px;">
        <button type="button" id="toggleAll" class="ghost" style="padding:6px 10px;border-radius:6px;">แสดง/ซ่อน เฉลยละเอียดทั้งหมด</button>
      </div>
    </div>` + output;

  // 3) สร้าง toggle เฉลยละเอียดใต้แต่ละข้อ
  const questionCards = new Set(keys.map(k => k.replace(/^q/,'').split('_')[0]));
  questionCards.forEach(qNum => ensureExplainToggle(qNum));
  showAllExplanations();

  const btn = document.getElementById('toggleAll');
  if (btn){
    let shown = true;
    btn.addEventListener('click',()=>{
      shown = !shown;
      document.querySelectorAll('details.explain').forEach(d=>{
        if (shown) d.classList.add('show'); else d.classList.remove('show');
      });
    });
  }

  // 4) ส่งหลังบ้าน (ต้องติ๊กยินยอมก่อน)
  const name    = document.getElementById('uName')?.value?.trim()  || '';
  const email   = document.getElementById('uEmail')?.value?.trim() || '';
  const consent = document.getElementById('consent')?.checked || false;
  if (!consent) {
    resultArea.insertAdjacentHTML('afterbegin',
      `<div class="alert">โปรดยินยอมให้เก็บข้อมูลก่อนบันทึกไปหลังบ้าน</div>`);
    return;
  }

  const payload = {
    name, email,
    score: correct, total, percent,
    quizVersion: 'mini-mock-1',
    answers: collectAllAnswers(),
    userAgent: navigator.userAgent,
    pageUrl: location.href
  };

  try {
    await sendResultToSheet(payload);
    resultArea.insertAdjacentHTML('afterbegin',
      `<div class="card" style="background:#edf2ff;border:1px solid #dbe7ff;margin-bottom:8px">
        บันทึกผลไปยังระบบหลังบ้าน (Google Sheet) เรียบร้อย ✅
      </div>`);
  } catch(e){
    // โหมด no-cors จะอ่านผลไม่ได้ จึงอาจเข้า catch เฉพาะกรณีเน็ตล่ม ฯลฯ
    resultArea.insertAdjacentHTML('afterbegin',
      `<div class="alert">บันทึกผลไปหลังบ้านไม่สำเร็จ แต่การตรวจคะแนนเสร็จสมบูรณ์แล้ว</div>`);
  }
});

resetBtn.addEventListener('click',()=>{
  document.getElementById('quizForm').reset();
  resultArea.innerHTML='';
  document.querySelectorAll('details.explain').forEach(d=>d.classList.remove('show'));
});
</script>

</body>
</html>
